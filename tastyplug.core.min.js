Array.prototype.isArray=!0,"undefined"!=typeof window.tastyPlugShutDown&&window.tastyPlugShutDown(),function(t){function e(){o(),i(),s(),n(),O.roomcheck=setInterval(function(){location.pathname!=N&&(clearInterval(O.roomcheck),N=location.pathname,a=function(){t("#room-loader").length?setTimeout(a,200):k(API.getUser())<2&&(t("#tp-histalert").remove(),t("#tp-mehtrack").remove(),t("#tp-joinlvl1").remove())},a())},1e3),"/tastycat"==N&&f(),W.autowoot&&T(),W.autojoin&&(j(),!I()&&-1==API.getWaitListPosition()&&API.getDJ()&&API.getDJ().id!=API.getUser().id&&A()),V.toggle(W.legacychat),Y.toggle(),h("init","TastyPlug v"+E+" now rising from the dead."),console.log("[TastyPlug v"+E+"] now rising from the dead.")}function o(){var t=JSON.parse(localStorage.getItem("tastyPlugSettings"));if(t)for(var e in W)if("undefined"!=typeof t[e])if(null!==t[e]&&t[e].isArray&&null!==W[e]&&W[e].isArray)W[e]=t[e];else if("object"==typeof W[e]&&null!==W[e]){var o=void 0;for(o in W[e])"undefined"!=typeof t[e][o]&&(W[e][o]=t[e][o]);"undefined"==typeof o&&(W[e]=t[e])}else W[e]=t[e]}function i(){t("head").append('<style type=text/css id=tastyplug-css>#tastyplug-ui{-moz-user-select:none;-webkit-user-select:none;position:absolute;width:150px;border-radius:10px;background-color:#1C1F25;background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0,#1C1F25),color-stop(1,#282D33));background-image:-o-linear-gradient(top,#1C1F25 0,#282D33 100%);background-image:-moz-linear-gradient(top,#1C1F25 0,#282D33 100%);background-image:-webkit-linear-gradient(top,#1C1F25 0,#282D33 100%);background-image:-ms-linear-gradient(top,#1C1F25 0,#282D33 100%);background-image:linear-gradient(to top,#1C1F25 0,#282D33 100%);z-index:9;padding-bottom:1.5px;color:#DDD}#tastyplug-ui a{color:inherit;text-decoration:none}.tastyplug-icon{position:relative;float:right}#tastyplug-ui .tp-toggle{color:#F04F30}#tastyplug-ui .tp-toggle.button-on{color:#1CC7ED}#tp-title{margin:0 15px;padding:3px 0;color:#A874FC;font-size:19px;cursor:move}.tp-mainbutton,.tp-secbutton{margin:0 15px;padding:2px 0 3px;font-size:15px;border-top:1px solid rgba(56,60,68,.85);cursor:pointer}.tp-highlight{background-color:rgba(168,116,252,.33)}.tp-secbutton{padding-left:8px}#tastyplug-ui .icon-drag-handle{position:relative;float:right;top:3px;height:14px;width:14px;background-position:-183px -113px}#waitlist-button .eta{left:45px;font-size:10px}#chat-messages .tastyplug-pm .icon{left:5.5px;top:6px}#chat-pm-button{left:-3px}#chat-messages div.tastyplug-pm.mention{background:linear-gradient(135deg,#FF00CB 0,#0a0a0a 13%,#0a0a0a 100%)}#chat-messages div.tastyplug-pm.mention:nth-child(2n+1){background:linear-gradient(135deg,#FF00CB 0,#111317 13%,#111317 100%)}#chat div[class*=" tp-"],#chat div[class^=tp-]{background-color:#0a0a0a}#chat div[class*=" tp-"]:nth-child(2n+1),#chat div[class^=tp-]:nth-child(2n+1){background-color:#111317}#chat-messages .tastyplug-pm .msg .from span.un{color:#FF00CB;font-weight:700}#user-lists .list.room .user .icon-meh{left:auto;right:8px;top:-1px}#chat-messages [data-cid|="3946454"]{background-color:#2D002D}#chat .mention:nth-child(2n+1)[data-cid|="3946454"],#chat .message:nth-child(2n+1)[data-cid|="3946454"],#chat-messages .emote:nth-child(2n+1)[data-cid|="3946454"]{background-color:#240024}#chat .emote[data-cid|="3946454"] .text,#chat .mention[data-cid|="3946454"] .text,#chat .message[data-cid|="3946454"] .text{font-weight:700;color:#CFCFCF}#chat .emote[data-cid|="3946454"] .text{font-style:normal}div.badge-box img.tastyplug-icon{padding:2px}#chat .cm.tp-info .text,#chat .cm.tp-info div.from.tastyplug span.un{color:#1CC7ED}#chat .cm.tp-info .text span{color:#EEE}#chat .cm.tp-error .text,#chat .cm.tp-error div.from.tastyplug span.un{color:#C42E3B}#chat .cm.tp-init .text,#chat .cm.tp-init div.from.tastyplug span.un{color:#D1D119}#chat .cm.tp-join-admin .text,#chat .cm.tp-join-admin div.from.tastyplug span.un{color:#1CC7ED}#chat .cm.tp-join-ba .text,#chat .cm.tp-join-ba div.from.tastyplug span.un{color:#088C30}#chat .cm.tp-join-host .text,#chat .cm.tp-join-host div.from.tastyplug span.un{color:#D1D119}#chat .cm.tp-join-cohost .text,#chat .cm.tp-join-cohost div.from.tastyplug span.un{color:#F59425}#chat .cm.tp-join-staff .text,#chat .cm.tp-join-staff div.from.tastyplug span.un{color:#C322E3}#chat .cm.tp-join-friend .text,#chat .cm.tp-join-friend div.from.tastyplug span.un{color:#009CDD}#chat .cm.tp-join-lvl1 .text,#chat .cm.tp-join-lvl1 div.from.tastyplug span.un{color:#FFDD6F}.tp-img{width:auto;height:auto;max-width:270px;max-height:250px}.legacy-chat .tastyplug-img-delete{top:26px}.tastyplug-img-delete{position:absolute;top:42px;right:4px;background-color:#F04F30;padding:0 3px;cursor:pointer;z-index:1}#playback .tp-video-hide,#playback.tp-video-hide{height:0!important}.custom-emote{display:inline-block;vertical-align:top}.custom-emote-mid{display:inline-block;vertical-align:middle}#chat-messages [data-cid|="3946454"] .bdg{background:url(https://tastyplug.tastycat.org/images/tastybot.png) no-repeat;}#chat-messages [data-cid|="3946454"] .badge-box{background:rgba(0,0,0,0)!important;}.icon-tp-pm{background:url(https://tastyplug.tastycat.org/images/private-message.png) no-repeat}</style>'),t("body").append('<div id=tp-room style=position:absolute;top:54px;left:0></div><div id=tastyplug-ui><div id=tp-title>TastyPlug <img class=tastyplug-icon src=https://tastyplug.tastycat.org/images/tastybot.png></div><div class="tp-mainbutton tp-toggle button-on" id=tp-autowoot><span>Autowoot</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-autojoin><span>Autojoin</span></div><div class="tp-mainbutton tp-toggle" id=tp-hidevideo><span>Hide Video</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-legacychat><span>Legacy Chat</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-boothalert><span>Booth Alert</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-histalert><span>History Alert</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-mehtrack><span>Meh Tracker</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-chatimgs><span>Chat Images</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-emotes><span>Cust. Emotes</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-emojis><div class="icon icon-drag-handle"></div><span>Tastymojis</span></div><div class="tp-secbutton tp-secmojis tp-toggle" id=tp-emojiios><span>iOS</span></div><div class="tp-secbutton tp-secmojis tp-toggle" id=tp-emojitwitter><span>Twitter</span></div><div class="tp-secbutton tp-secmojis tp-toggle" id=tp-emojiemojione><span>Emojione</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-mentions><div class="icon icon-drag-handle"></div><span>Chat Mentions</span></div><div class="tp-secbutton tp-secmention" id=tp-addmention><span>Add</span></div><div class="tp-secbutton tp-secmention" id=tp-delmention><span>Delete</span></div><div class="tp-secbutton tp-secmention" id=tp-listmention><span>List</span></div><div class="tp-mainbutton tp-toggle button-on" id=tp-joinnotifs><div class="icon icon-drag-handle"></div><span>Join Notifs.</span></div><div class="tp-secbutton tp-secjoin tp-toggle button-on" id=tp-joinranks><span>Ranks</span></div><div class="tp-secbutton tp-secjoin tp-toggle button-on" id=tp-joinfriends><span>Friends</span></div><div class="tp-secbutton tp-secjoin tp-toggle button-on" id=tp-joinlvl1><span>Level 1s</span></div><a href=https://emotes.tastycat.org target=_blank><div class=tp-mainbutton id=tp-listemotes><span>Emotes List</span></div></a></div>'),"/tastycat"==N&&t("#waitlist-button").append('<span class="eta"></span>'),"/hummingbird-me"==N&&t("#tp-autojoin").remove(),W.autowoot||t("#tp-autowoot").removeClass("button-on"),W.autojoin||t("#tp-autojoin").removeClass("button-on"),W.boothalert||t("#tp-boothalert").removeClass("button-on"),W.legacychat||t("#tp-legacychat").removeClass("button-on"),W.histalert||t("#tp-histalert").removeClass("button-on"),W.mehtrack||t("#tp-mehtrack").removeClass("button-on"),W.chatimgs||t("#tp-chatimgs").removeClass("button-on"),W.emotes||t("#tp-emotes").removeClass("button-on"),W.tastymojis||t("#tp-emojis").removeClass("button-on"),t("#tp-emoji"+W.emojiset).addClass("button-on"),W.chatmentions||t("#tp-mentions").removeClass("button-on"),W.joinnotifs.toggle||t("#tp-joinnotifs").removeClass("button-on"),W.joinnotifs.ranks||t("#tp-joinranks").removeClass("button-on"),W.joinnotifs.friends||t("#tp-joinfriends").removeClass("button-on"),W.joinnotifs.lvl1||t("#tp-joinlvl1").removeClass("button-on"),W.show||(t(".tp-mainbutton").hide(),t("#tastyplug-ui").css("padding-bottom","0")),k(API.getUser())<2&&(t("#tp-histalert").remove(),t("#tp-mehtrack").remove(),t("#tp-joinlvl1").remove()),t(".tp-secbutton").hide(),t("#tastyplug-ui").css(W.uipos);var e={width:t(".app-right").position().left,height:t(".app-right").height()};t("#tp-room").css(e),v(),t("body").append('<audio id="default-sound"><source src="https://cdn.plug.dj/_/static/sfx/badoop.801a12ca13864e90203193b2c83c019c03a447d1.mp3"></audio>')}function s(){API.on({chat:c,userJoin:l,waitListUpdate:d,advance:p,chatCommand:g,voteUpdate:m}),API.on("voteUpdate",u),t(window).resize(v),t("#users-button:not(.selected)").click(m);var e={distance:20,handle:"#tp-title",containment:"#tp-room",scroll:!1,start:function(){L=!0},stop:function(t,e){L=!1,W.uipos=e.position,P()}};t("#tastyplug-ui").draggable(e),t("#now-playing-media").hover(function(){if(B=!0,API.getMedia()){var e=t("#now-playing-bar").position().left+74;t("body").append('<div id="tooltip" class="tp-songtitle" style="top:6px;left:'+e+'px"><span>'+API.getMedia().author+" - "+API.getMedia().title+'</span><div class="corner"></div></div>')}},function(){B=!1,t("#tooltip.tp-songtitle").remove()}),t(".tp-mainbutton,.tp-secbutton").hover(function(){t(this).addClass("tp-highlight")},function(){t(this).removeClass("tp-highlight")}),t("#tp-title").mouseup(function(){L||(W.show=!W.show,W.show||(t("#tastyplug-ui").css("padding-bottom","0"),t(".tp-mainbutton").css("border-top","0"),t(".tp-secbutton").css("border-top","0")),t("#tastyplug-ui .tp-mainbutton").slideToggle(function(){W.show&&(t("#tastyplug-ui").css("padding-bottom",""),t(".tp-mainbutton").css("border-top",""),t(".tp-secbutton").css("border-top",""))}),t(".tp-secbutton,.tp-infobutt").slideUp(),P())}),t("#tp-autowoot").click(function(){W.autowoot=!W.autowoot,t(this).toggleClass("button-on"),W.autowoot&&T(),P()}),t("#tp-autojoin").click(function(){W.autojoin=!W.autojoin,t(this).toggleClass("button-on"),W.autojoin&&!I()&&-1==API.getWaitListPosition()&&A(),j(),P()}),t("#tp-hidevideo").click(function(){F=!F,t("#playback-container").toggleClass("tp-video-hide"),t("#playback").toggleClass("tp-video-hide"),F?t(".background").hide():t(".background").show(),t(this).toggleClass("button-on")}),t("#tp-mehtrack").click(function(){W.mehtrack=!W.mehtrack,t(this).toggleClass("button-on"),P()}),t("#tp-boothalert").click(function(){W.boothalert=!W.boothalert,t(this).toggleClass("button-on"),P()}),t("#tp-legacychat").click(function(){W.legacychat=!W.legacychat,t(this).toggleClass("button-on"),V.toggle(W.legacychat),P()}),t("#tp-histalert").click(function(){W.histalert=!W.histalert,t(this).toggleClass("button-on"),P()}),t("#tp-chatimgs").click(function(){W.chatimgs=!W.chatimgs,t(this).toggleClass("button-on"),P()}),t("#tp-emotes").click(function(){W.emotes=!W.emotes,t(this).toggleClass("button-on"),P()}),t("#tp-emojis .icon-drag-handle").click(function(){t(".tp-secmojis").slideToggle()}),t("#tp-emojis span").click(function(){W.tastymojis=!W.tastymojis,t(this).parent().toggleClass("button-on"),Y&&Y.toggle(),P()}),t("#tp-emojiios").click(function(){"ios"!=W.emojiset&&(t("#tp-emoji"+W.emojiset).removeClass("button-on"),W.emojiset="ios",t(this).toggleClass("button-on"),Y.toggle(!0),P())}),t("#tp-emojitwitter").click(function(){"twitter"!=W.emojiset&&(t("#tp-emoji"+W.emojiset).removeClass("button-on"),W.emojiset="twitter",t(this).toggleClass("button-on"),Y.toggle(!0),P())}),t("#tp-emojiemojione").click(function(){"emojione"!=W.emojiset&&(t("#tp-emoji"+W.emojiset).removeClass("button-on"),W.emojiset="emojione",t(this).toggleClass("button-on"),Y.toggle(!0),P())}),t("#tp-mentions span").click(function(){W.chatmentions=!W.chatmentions,t(this).parent().toggleClass("button-on"),P()}),t("#tp-addmention").click(function(){var t=W.msgs.length,e=prompt("Add words to the chat mentions list! Separate them with a comma.").trim().split(",");if(!e)return h("error","Please enter at least one word!");for(var o=0;o<e.length;o++)e[o]=e[o].trim().toLowerCase(),e[o].length<3?h("error","Did not add: "+_.escape(e[o])+" (too short)"):W.msgs.indexOf(e[o])>-1?h("error","Did not add: "+_.escape(e[o])+" (already on list)"):W.msgs.push(e[o]);W.msgs.length>t&&(h("info","Added word(s) to chat mentions list"),P())}),t("#tp-delmention").click(function(){var t=prompt("Which word would you like to remove from the mentions list?");W.msgs.indexOf(t)>-1?(W.msgs.splice(W.msgs.indexOf(t),1),h("info",'Removed "'+_.escape(t)+'" from the chat mentions list'),P()):h("error","That word isn't in the mentions list!")}),t("#tp-listmention").click(function(){for(var t=W.msgs,e=[],o=0;o<t.length;o++)e.push(_.escape(t[o]));return t.length?h("info","Chat mentions list:<br>"+e.join("<br>")):h("error","You don't have anything in your chat mentions list!")}),t("#tp-mentions .icon-drag-handle").click(function(){t(".tp-secmention").slideToggle()}),t("#tp-joinnotifs span").click(function(){W.joinnotifs.toggle=!W.joinnotifs.toggle,t(this).parent().toggleClass("button-on"),P()}),t("#tp-joinranks").click(function(){W.joinnotifs.ranks=!W.joinnotifs.ranks,t(this).toggleClass("button-on"),P()}),t("#tp-joinfriends").click(function(){W.joinnotifs.friends=!W.joinnotifs.friends,t(this).toggleClass("button-on"),P()}),t("#tp-joinlvl1").click(function(){W.joinnotifs.lvl1=!W.joinnotifs.lvl1,t(this).toggleClass("button-on"),P()}),t("#tp-joinnotifs .icon-drag-handle").click(function(){t(".tp-secjoin").slideToggle()})}function n(){t.ajax({cache:!1,url:"https://emotes.tastycat.org/emotes-full.json",dataType:"json",success:function(t){for(var e in t.emotes)t.emotes.hasOwnProperty(e)&&(J[e.toLowerCase()]=t.emotes[e])},error:function(){h("error","Could not load the TastyPlug custom emotes. Refresh and/or try again later.")}})}function r(){t(".icon-chat-sound-on").length&&document.getElementById("default-sound").play()}function c(e){if(e.cid&&e.cid!=U){U=e.cid;var o=t(".cid-"+e.cid).parent();if(W.emotes){var i=o.find(".text"),s=i.html(),n=t("#chat-messages"),a=n.scrollTop()>n[0].scrollHeight-n.height()-28;s=C(s),i.html(s),a&&n.scrollTop(n[0].scrollHeight)}if(W.chatimgs&&-1==e.message.toLowerCase().indexOf("nsfw"))for(var i=o.find(".text"),c=i.text().trim().split(" "),l=0;l<c.length;l++)if(/^https?:\/\//i.test(c[l])){if(/.(gif|png|jpe?g)/i.test(c[l]))return w(c[l],i);if(/.(webm|gifv)$/i.test(c[l]))return x(c[l],i)}var d=document.createElement("div");d.innerHTML=e.message;var p=d.textContent.replace(/  +/g," ").trim();if(e.uid==API.getUser().id&&(D=Date.now()),W.chatmentions&&e.uid!=API.getUser().id&&"mention"!=e.type){d=p.toLowerCase().split(" ");for(var l=0;l<W.msgs.length;l++)if(d.indexOf(W.msgs[l])>-1)return r()}}}function l(t){if(W.joinnotifs.toggle&&t.username&&(W.joinnotifs.ranks||W.joinnotifs.friends||W.joinnotifs.lvl1)){var e,o=k(t),i="";if(o)switch(o){case 10:e="admin";break;case 8:e="ba";break;case 5:e="host";break;case 4:e="cohost";break;case 3:case 2:case 1:e="staff";break;default:e="undef"}else W.joinnotifs.friends&&t.friend?e="friend":W.joinnotifs.lvl1&&k(API.getUser())>=2&&1==t.level&&(e="lvl1");e&&("lvl1"==e&&(i+="[Lvl 1 - ID: "+t.id+"] "),i+=_.escape(t.username)+" joined the room",h("join-"+e,i))}}function d(){W.autojoin&&!I()&&-1==API.getWaitListPosition()&&A(),W.boothalert&&API.getWaitListPosition()<W.boothnotify&&-1!=API.getWaitListPosition()&&!S&&(r(),h("info","[Booth Alert] It's almost your turn to DJ! Make sure to pick a song!"),S=!0)}function p(e){if(W.autojoin&&!I()&&-1==API.getWaitListPosition()&&A(),W.autowoot&&setTimeout(T,1e3*(Math.floor(10*Math.random())+1)),e.dj){if(e.dj.id==API.getUser().id&&(S=!1),W.histalert&&k(API.getUser())>=2&&e.media)for(var o=API.getHistory(),i=0;i<o.length;i++)if(o[i].media.cid==e.media.cid){h("error","This song is on the history! (played "+(i+1)+" song"+(0==i?"":"s")+" ago)"),r();break}if(R={},B&&(t("#tooltip.tp-songtitle").remove(),API.getMedia())){var s=t("#now-playing-bar").position().left+74;t("body").append('<div id="tooltip" class="tp-songtitle" style="top:6px;left:'+s+'px"><span>'+API.getMedia().author+" - "+API.getMedia().title+'</span><div class="corner"></div></div>')}}}function g(t){var e=t.trim().substr(1).split(" ")[0].toLowerCase(),o={uid:API.getUser().id,un:API.getUser().username,message:t.trim(),room:N};H[e]&&H[e](o)}function u(t){W.mehtrack&&k(API.getUser())>=2&&-1==t.vote&&!R[t.user.id]&&(R[t.user.id]=!0,h("error",_.escape(t.user.username)+" meh'd the song!"))}function m(){if(t("#users-button").hasClass("selected")&&t(".button.room").hasClass("selected")){t("#user-lists .list.room i.icon.icon-meh").remove();var e=t(API.getUsers()).filter(function(){return-1==this.vote&&!this.curated});e.each(function(o){t("#user-lists .list.room .user span").filter(function(){return t(this).text()==e[o].username}).parent().append('<i class="icon icon-meh"></i>')})}}function h(e,o){if("block"==t("#chat-button").css("display")){var i=t("#chat-messages"),s=i.scrollTop()>i[0].scrollHeight-i.height()-28,n=t("#chat-timestamp-button .icon").attr("class").substr(21),a="TastyPlug",r=(new Date).toTimeString().substr(0,5);if("12"==n){var c=parseInt(r),l=c>=12?"pm":"am",d=c%12==0?"12":c%12;r=d+r.substr(2)+l}"0"==r.charAt(0)&&(r=r.substr(1)),i.append('<div class="cm message tastyplug-message tp-'+e+'"><div class="badge-box"><img class="tastyplug-icon" src="https://tastyplug.tastycat.org/images/tastybot.png"/></div><div class="msg"><div class="from tastyplug"><span class="un">'+a+'</span><span class="timestamp" style="display: inline;">'+r+'</span></div><div class="text">'+o+"</div></div></div>"),s&&i.scrollTop(i[0].scrollHeight),i.children().length>=512&&i.children().first().remove()}else API.chatLog(o.replace(/<br>/g,", ").replace(/<\/?span>/g,""),!0)}function f(){O.eta=setInterval(function(){var e=API.getWaitListPosition(),o=-1==e?"":"ETA: "+y(1e3*e*60*4+1e3*API.getTimeRemaining());t("#waitlist-button").find(".eta").text(o)},1e4)}function v(){var e=t("#tp-room"),o=e.position(),i=e.width(),s=e.height(),n=t("#tastyplug-ui"),a=n.position(),r=n.width(),c=n.height(),l=Object.keys(o),d={width:t(".app-right").position().left,height:t(".app-right").height()};t("#tp-room").css(d);for(var p=0;p<l.length;p++)a[l[p]]<o[l[p]]&&n.css(l[p],o[l[p]]);a=t("#tastyplug-ui").position(),r+a.left>i&&n.css("left",i-r),c+a.top>s&&n.css("top",s-c),W.uipos=n.position(),W.fullscreen&&fullScreen(),P()}function b(t){t=t.trim().toLowerCase();for(var e=API.getUsers(),o=0;o<e.length;o++)if(e[o].username.toLowerCase()==t)return e[o];return null}function y(t){t=Math.floor(t/6e4);var e=t-60*Math.floor(t/60),o=(t-e)/60,i="";return i+=o+"h",i+=10>e?"0":"",i+=e}function k(t){if(t.gRole)switch(t.gRole){case 5:return 10;case 4:case 3:case 2:return 8;default:return 6}return t.role}function j(){W.autojoin?O.afkInt=setInterval(function(){Date.now()-D>=12e5&&(W.autojoin=!1,t("#tp-autojoin").removeClass("button-on"),clearInterval(O.afkInt))},6e4):clearInterval(O.afkInt)}function w(e,o){var i=new Image;i.onload=function(){i.className+="tp-img";var s=o.html().replace('<a href="'+e+'" target="_blank">'+e+"</a>",'<br><a href="'+e+'" target="_blank">'+i.outerHTML+"</div></a>");0==s.indexOf("<br>")&&(s=s.substr(4)),o.parent().append('<div class="tastyplug-img-delete" style="display:none">X</div>'),o.parent().parent().hover(function(){t(this).find(".tastyplug-img-delete").css("display","block")},function(){t(this).find(".tastyplug-img-delete").css("display","none")}),o.parent().find(".tastyplug-img-delete").click(function(){var e=t(this).parent().find("img")[0].src;t(this).parent().find("br").remove(),t(this).parent().find("img").parent().append(e).find("img").remove(),t(this).remove()});var n=t("#chat-messages"),a=n.scrollTop()>n[0].scrollHeight-n.height()-28;o.html(s),a&&n.scrollTop(n[0].scrollHeight)},i.src=e}function x(e,o){var i=e.replace(/.gifv$/i,".webm"),s=o.html().replace('<a href="'+e+'" target="_blank">'+e+"</a>",'<br><a href="'+e+'" target="_blank"><video autoplay muted loop class="tp-img"><source src="'+i+'"></video></a>');0==s.indexOf("<br>")&&(s=s.substr(4)),o.parent().append('<div class="tastyplug-img-delete" style="display:none">X</div>'),o.parent().parent().hover(function(){t(this).find(".tastyplug-img-delete").css("display","block")},function(){t(this).find(".tastyplug-img-delete").css("display","block")}),o.parent().find(".tastyplug-img-delete").click(function(){var e=t(this).parent().find("video a").first().text();t(this).parent().find("br").remove(),t(this).parent().find("video").parent().append('<a href="'+e+'" target="_blank">'+e+"</a>").find("video").remove(),t(this).remove()});var n=t("#chat-messages"),a=n.scrollTop()>n[0].scrollHeight-n.height()-28;o.html(s),a&&n.scrollTop(n[0].scrollHeight)}function C(t){if(Object.keys(J).length&&"string"==typeof t){var e=t.match(/:[^:\s]+:/g);if(!e)return t;for(var o=0;o<e.length;o++){var i=e[o].substring(1,e[o].length-1).toLowerCase();for(var s in J)if(i==s.toLowerCase()){if(!W.hidden&&J[s].hidden)break;for(var n=t.split(e[o]),a=n[0],r=1;r<n.length;r++){var c=parseInt(J[s].height)<20?"-mid":"";a+='<div class="custom-emote'+c+'" title="'+(J[s].hidden?"Hidden Emote!":s)+'" style="background-image:url('+J[s].url+");width:"+J[s].width+"px;height:"+J[s].height+'px;"></div>',a+=n[r]}t=a;break}}return t}}function A(){M||"/hummingbird-me"==N||(API.djJoin(),M=!0,setTimeout(function(){M=!1},5e3))}function P(){localStorage.setItem("tastyPlugSettings",JSON.stringify(W))}function I(){return t(".lock-toggle .icon").hasClass("icon-locked")}function T(){t("#woot").click()}var U,D=Date.now(),L=!1,F=!1,M=!1,E="3.8.0",H={},O={},S=!1,B=!1,N=location.pathname,R={},J={},W={show:!0,autowoot:!1,autojoin:!1,chatmentions:!1,joinnotifs:{toggle:!1,ranks:!1,friends:!1,lvl1:!1},msgs:[],lastPM:null,uipos:{top:"54px",left:"0"},boothalert:!1,boothnotify:3,legacychat:!1,histalert:!1,mehtrack:!1,chatimgs:!1,emotes:!1,hidden:!1,mention:0,tastymojis:!1,emojiset:"ios"},z=!1;window.tastyPlugShutDown=function(){z=!0,API.off({chat:c,userJoin:l,waitListUpdate:d,advance:p,chatCommand:g,voteUpdate:m}),API.off("voteUpdate",u),t(window).off("resize",v),t("#users-button").off("click",m),t("#chat-messages .pm-from").off("click"),t(".tp-img-delete").off("click"),t("#chat-messages .message,#chat-messages .mention,#chat-messages .emote").has("img").off("mouseenter mouseleave"),t("#now-playing-media").off("mouseenter mouseleave"),t("#chat-pm-button").remove(),t("#waitlist-button").find(".eta").remove(),t("#playback-container").removeClass("tp-video-hide"),t(".background").show(),t("#playback").removeClass("tp-video-hide"),t("#tastyplug-ui").remove(),t("#tastyplug-css").remove(),t("#legacy-chat-stylesheet").remove(),t("#tp-room").remove(),t("#tooltip.tp-songtitle").remove(),V.toggle(!1),t("#tastymojis-css").remove();for(var e in O)clearInterval(O[e]);P(),console.log("[TastyPlug v"+E+"] shut down.")},H.opcheck=function(t){var e=API.getNextMedia().media;API.sendChat("!opcheck cid "+e.format+" "+e.cid)},H.lock=function(t){k(API.getUser())>=3&&API.moderateLockWaitList(!0)},H.unlock=function(t){k(API.getUser())>=3&&API.moderateLockWaitList(!1)},H.cycle=function(e){k(API.getUser())>=3&&t(".cycle-toggle").click()},H.ban=function(t){if(!(k(API.getUser())<3)){var e=b(t.message.substr(t.message.indexOf("@")+1));return e?k(e)?h("error","You shouldn't ban those with ranks!"):void API.moderateBanUser(e.id,0,API.BAN.PERMA):h("error","User not found.")}},H.kick=function(t){if(!(k(API.getUser())<2)){var e,o,i=t.message.split(" ");if(e=b(i.slice(1,i.length-1).join(" ").substr(1)),!e)return h("error","User not found.");if(e.role||e.gRole)return h("error","You shouldn't kick those with ranks!");o="day"==i[i.length-1]?API.BAN.DAY:API.BAN.HOUR,API.moderateBanUser(e.id,0,o)}},H.skip=function(t){k(API.getUser())>=2&&API.moderateForceSkip()},H.mute=function(t){var e=t.message.split(" ");if(1==e.length)return!1;var o,i;switch(e[e.length-1].toLowerCase()){case"s":case"short":case"15":o=API.MUTE.SHORT,i=b(e.slice(1,e.length-1).join(" ").substr(1));break;case"m":case"medium":case"30":o=API.MUTE.MEDIUM,i=b(e.slice(1,e.length-1).join(" ").substr(1));break;case"l":case"long":case"45":o=API.MUTE.LONG,i=b(e.slice(1,e.length-1).join(" ").substr(1));break;default:o=API.MUTE.SHORT,i=b(e.slice(1).join(" ").substr(1))}return i?k(i)?h("error","You can't mute those with ranks!"):void API.moderateMuteUser(i.id,1,o):h("error","User not found.")},H.commands=function(){"/tastycat"==N&&h("info",'Tastybot commands: <a href="http://tastycat.org/tastybot/" target="_blank">Click Here</a>'),h("info","TastyPlug commands: <span>"+Object.keys(H).join(", ")+"</span>")},H.whois=function(t){var e,o=b(t.message.split(" ").slice(1).join(" ").substr(1));if(!o)return h("error","User not found.");var i=API.getWaitListPosition(o.id);switch(k(o)){case 10:e="plug.dj Admin";break;case 8:e="Brand Ambassador";break;case 5:e="Host";break;case 4:e="Co-Host";break;case 3:e="Manager";break;case 2:e="Bouncer";break;case 1:e="Resident DJ";break;case 0:e="User";break;default:e="Unknown"}API.getDJ().id==o.id?i="Currently DJing":-1==i?i="Not on list":i++,h("info","Username: <span>"+o.username+"</span><br>ID: <span>"+o.id+"</span><br>Rank: <span>"+e+"</span><br>Level: <span>"+o.level+"</span><br>Wait List: <span>"+i+"</span>")},H.link=function(){var t=API.getMedia();"1"==t.format?h("info",'Current song: <a href="http://youtu.be/'+t.cid+'" target="_blank">Click Here</a>'):SC.get("/tracks/"+t.cid,function(t){h("info","Current song: "+(t.permalink_url?'<a href="'+t.permalink_url+'" target="_blank">Click Here</a>':"Link not found"))})},H.pic=function(){var t=API.getMedia();1==t.format?h("info",'Video image: <a href="http://i1.ytimg.com/vi/'+t.cid+'/maxresdefault.jpg" target="_blank">Click Here</a>'):SC.get("/tracks/"+t.cid,function(t){h("info","Song art: "+(t.artwork_url?'<a href="'+t.artwork_url+'" target="_blank">Click Here</a>':"Artwork unavailable"))})},H.uireset=function(){W.uipos={top:"54px",left:"0"},t("#tastyplug-ui").css(W.uipos),P(),h("info","UI position reset")},H.hidden=function(){W.hidden=!W.hidden,P(),h("info","Hidden emotes "+(W.hidden?"enabled!":"disabled!"))},H.profile=function(t){var e,o,i,s=t.message.substr(10),o="@/";e=s||API.getUser().username,i=e.replace(/(_|\[|\]|\(|\)|\.)/g," ").replace(/'/g,"").trim(),o+=encodeURI(i.replace(/( )/gi,"-")).toLowerCase(),h("info","Profile link for <span>"+e+':</span> <a href="'+o+'" target="_blank">Click here</a>')},H.boothnotify=function(t){var e=t.message.substr(13);W.boothnotify=~~e||3,h("info","Booth Alert notification spot changed to spot <span>"+W.boothnotify+"</span>."),P()};var Y=function(){var e="#chat span.emoji-sizer{width:22px;height:22px;}",o=function(o){o?(console.log(W.emojiset),W.tastymojis&&t("#tastymojis-css").text(e+("ios"!=W.emojiset?"span.emoji-inner{background:url('https://tastyplug.tastycat.org/images/"+W.emojiset+".png')":""))):W.tastymojis?t("head").append('<style id="tastymojis-css" type="text/css">'+e+("ios"!=W.emojiset?"span.emoji-inner{background:url('https://tastyplug.tastycat.org/images/"+W.emojiset+".png')":"")+"</style>"):t("style#tastymojis-css").remove()};return{toggle:o}}(),V=function(){"use strict";var e="div#chat-messages div.cm.legacy-chat{min-height:0;width:auto}div#chat div.cm.legacy-chat.mention{background:#0a0a0a}div#chat div.cm.legacy-chat.mention:nth-child(2n+1){background:#111317}div#chat-messages div.legacy-chat div.badge-box{height:0;overflow:hidden;position:absolute}#chat-messages div.from.pm span.pm-header{padding:0;color:#FF00CB}#chat-messages div.legacy-chat i.icon{margin:6px}#chat-messages div.legacy-chat i.icon.icon-tp-pm{margin:0}#chat-messages div.legacy-chat.is-admin{border-left:3px solid #42a5dc}#chat-messages div.legacy-chat.is-ambassador{border-left:3px solid #89be6c}#chat-messages div.legacy-chat.is-staff,#chat-messages div.legacy-chat.is-dj{border-left:3px solid #ac76ff}#chat-messages div.legacy-chat.is-you{border-left:3px solid #ffdd6f}#chat-messages div.legacy-chat.is-pm{border-left:3px solid #FF00CB}#chat-messages div.legacy-chat div.msg{padding:4px 5px 5px 27px}div.legacy-chat div.msg div.from span.un{padding-right:3px}#chat-messages div.text{display:inline}#chat-messages div.text:before{content:' '}div.legacy-chat.mention div.msg div.from div.text,div.legacy-chat.message div.msg div.from div.text{color:#eee}div.legacy-chat div.msg div.from:before{content:'';float:right;width:50px;height:1px}#chat-messages div.legacy-chat div.msg div.from span.timestamp{position:absolute;right:0;top:1px;float:right}.tastyplug-message.legacy-chat span.un{display:none}#chat-messages div.mention.legacy-chat i.icon,#chat-messages div.mention.legacy-chat i.icon.icon-tp-pm{left:-2px}#chat-messages div.mention div.msg{padding-left:24px}#chat-messages .legacy-chat .delete-button{padding:1px 7px}#chat-messages .tastyplug-pm.mention i.icon.icon-tp-pm.legacy-fake-icon{left:1px}#chat-messages i.icon.icon-tp-pm.legacy-fake-icon{left:4px}",o='<style id="legacy-chat-stylesheet" type="text/css">'+e+"</style>",i=!1;t("head").append(o);var s=function(e){e.addClass("legacy-chat");var o=e.find("div.badge-box"),i=e.find("div.msg"),s=i.find("div.from"),n=s.children("i.icon"),a=i.find("div.text"),r=(s.find("span.timestamp"),s.find("span.un"));if(n.hide(),i.children("div.subscriber")[0])n=t('<i class="icon icon-chat-subscriber legacy-fake-icon"></i>'),n.insertAfter(o);else if(i.children("div.staff, div.dj")[0]){var c=n.last().clone();c.addClass("legacy-fake-icon"),c.insertAfter(o),c.show()}else if(i.children("div.you")[0]){var l=n.filter(".icon-chat-ambassador"),d=l.length?l:n.last();n.not(d).hide(),d.insertAfter(o),d.show()}else i.children("div.ambassador")[0]?(n=t('<i class="icon icon-chat-ambassador legacy-fake-icon"></i>'),n.insertAfter(o)):i.children("div.from.pm")[0]?(n=t('<i class="icon icon-tp-pm legacy-fake-icon"></i>'),n.insertAfter(o)):i.children("div.admin")[0]&&(n=t('<i class="icon icon-chat-admin legacy-fake-icon"></i>'),n.insertAfter(o));a.insertAfter(r)},n=function(t){var e=t.find("div.msg"),o=e.find("div.from"),i=(o.find("span.un"),e.find("div.text")),s=(e.find("span.timestamp"),t.children("i.icon:not(.legacy-fake-icon)"));s.length&&o.prepend(s),o.children().show(),i.insertAfter(o),t.removeClass("legacy-chat")},a=new MutationObserver(function(e){e.forEach(function(e){if(i){var o=e.addedNodes,n=0;for(n=0;n<o.length;++n)o[n].nodeType===Node.ELEMENT_NODE&&s(t(o[n]).find("*").andSelf().filter("div.cm:not(.legacy-chat,.welcome,.update)"))}})}),r=function(e){if(i=void 0!==e?e:!i){var o=document.querySelector("#chat-messages");a.observe(o,{childList:!0}),t("#chat-messages div.cm:not(.legacy-chat,.welcome,.update)").each(function(){s(t(this))})}else a.disconnect(),t("div.legacy-chat").each(function(){n(t(this))}),t("i.legacy-fake-icon").remove();t("#chat-messages").scrollTop(t("#chat-messages")[0].scrollHeight)};return{toggle:r}}(),X=!1,$=function(){z||("undefined"!=typeof API&&API.enabled?e():API.getUser().guest?(X||(h("error","Must be logged in to use tastyplug!"),console.log("[TastyPlug v"+E+"] Can't load as a guest.  Checking if logged in every in 2 seconds."),X=!0),setTimeout($,2e3)):setTimeout($,200))};$()}(window.jQuery);